from flask import Flask, redirect, url_for, render_template, request, session
import requestAPI
from requestAPI import RequestAPI
import json
import solrFunctions
from googletrans import Translator

app = Flask(__name__)

app.secret_key = "key_secreta_do_site_de_pri"

# Uncomment if solr is opened
request_api = RequestAPI()
request_api.open(url='http://localhost:8983/solr/steam')


@app.route("/")  # this sets the route to this page
def home():
	return redirect(url_for('search'))

@app.route("/search", methods=["GET"])  # this sets the route to this page
def search():
	return render_template("search.html")

@app.route("/game_<id>", methods=["GET"])  # this sets the route to this page
def game(id):
	
	target = {'url': ['https://store.steampowered.com/app/379720/DOOM/'], 'name': ['DOOM'], 'desc_snippet': 'Now includes all three premium DLC packs (Unto the Evil, Hell Followed, and Bloodfall), maps, modes, and weapons, as well as all feature updates including Arcade Mode, Photo Mode, and the latest Update 6.66, which brings further multiplayer improvements as well as revamps multiplayer progression.', 'recent_reviews': [89], 'all_reviews': [92], 'release_date': ['2016-05-12T00:00:00Z'], 'developer': ['id Software'], 'publisher': ['Bethesda Softworks'], 'popular_tags': ['FPS', 'Gore', 'Action', 'Demons', 'Shooter', 'First-Person', 'Great Soundtrack', 'Multiplayer', 'Singleplayer', 'Fast-Paced', 'Sci-fi', 'Horror', 'Classic', 'Atmospheric', 'Difficult', 'Blood', 'Remake', 'Zombies', 'Co-op', 'Memes'], 'game_details': ['Single-player', 'Multi-player', 'Co-op', 'Steam Achievements', 'Steam Trading Cards', 'Partial Controller Support', 'Steam Cloud'], 'languages': ['English', 'French', 'Italian', 'German', 'Spanish - Spain', 'Japanese', 'Polish', 'Portuguese - Brazil', 'Russian', 'Traditional Chinese'], 'achievements': [54.0], 'genre': ['Action'], 'game_description': ' About This Game Developed by id software, the studio that pioneered the first-person shooter genre and created multiplayer Deathmatch, DOOM returns as a brutally fun and challenging modern-day shooter experience. Relentless demons, impossibly destructive guns, and fast, fluid movement provide the foundation for intense, first-person combat – whether you’re obliterating demon hordes through the depths of Hell in the single-player campaign, or competing against your friends in numerous multiplayer modes. Expand your gameplay experience using DOOM SnapMap game editor to easily create, play, and share your content with the world. STORY: You’ve come here for a reason. The Union Aerospace Corporation’s massive research facility on Mars is overwhelmed by fierce and powerful demons, and only one person stands between their world and ours.  As the lone DOOM Marine, you’ve been activated to do one thing – kill them all. KEY FEATURES: A Relentless Campaign There is no taking cover or stopping to regenerate health as you beat back Hell’s raging demon hordes.  Combine your arsenal of futuristic and iconic guns, upgrades, movement and an advanced melee system to knock-down, slash, stomp, crush, and blow apart demons in creative and violent ways. Return of id Multiplayer Dominate your opponents in DOOM’s signature, fast-paced arena-style combat. In both classic and all-new game modes, annihilate your enemies utilizing your personal blend of skill, powerful weapons, vertical movement, and unique power-ups that allow you to play as a demon. Endless Possibilities DOOM SnapMap – a powerful, but easy-to-use game and level editor – allows for limitless gameplay experiences on every platform.  Without any previous experience or special expertise, any player can quickly and easily snap together and visually customize maps, add pre-defined or completely custom gameplay, and even edit game logic to create new modes.  Instantly play your creation, share it with a friend, or make it available to players around the world – all in-game with the push of a button. ', 'minimum_requirements': ['Minimum:,OS:,Windows 7/8.1/10 (64-bit versions),Processor:,Intel Core i5-2400/AMD FX-8320 or better,Memory:,8 GB RAM,Graphics:,NVIDIA GTX 670 2GB/AMD Radeon HD 7870 2GB or better,Storage:,55 GB available space,Additional Notes:,Requires Steam activation and broadband internet connection for Multiplayer and SnapMap'], 'recommended_requirements': ['Recommended:,OS:,Windows 7/8.1/10 (64-bit versions),Processor:,Intel Core i7-3770/AMD FX-8350 or better,Memory:,8 GB RAM,Graphics:,NVIDIA GTX 970 4GB/AMD Radeon R9 290 4GB or better,Storage:,55 GB available space,Additional Notes:,Requires Steam activation and broadband internet connection for Multiplayer and SnapMap'], 'original_price': [19.99], 'app_id': [379720], 'reviews': ["Dark Souls: you're stuck in a room with demons\n\nDoom: Demons are stuck in a room with you", "As a psychological consultant, here's my professional opinion:\n\nYou angry? Play DOOM to let it all out.\nYou depressed? Play DOOM to feel satisfaction.\nYou shy? Play DOOM to gain confidence.\nYou fine? Play DOOM to feel [b]even better[/b].\n\nGames don't cause violence. Go squash in some heads. Go blow off some steam. Have fun.", 'Are you angry? - Play DOOM.\nAre you in a bad mood? - Play DOOM.\nAre you in a good mood? - Play DOOM.\nDid you have a bad day at work? - Play DOOM.\nIs your boss a jerk? - Play DOOM.\nYour girlfriend dumped you? - Play DOOM.\nDo you feel lonely? - Play DOOM.\nPlay DOOM? - Play DOOM.\n', "Dark Souls: you're stuck in a room with demons\n\nDoom: Demons are stuck in a room with you\n", 'Other games: 20 min. intro and tutorial.\n\nDoom: Here is a gun. Shoot everything.', "Yep, It's a survival horror game. You play as the horror, and the demons are trying to survive.", '1. Do you like FPS games?\n2. Do you like violence?\n3. Do you like gory violence?\n4. Do you like gory, violent FPS games?\n5. Do you like gory, violent FPS games with a great sense of humour?\n6. Do you like metal?\n\nIf you answered yes to any of those questions, this is the game for you.\n\nBrutal.', 'Its a survival horror game. But for your enemies.\n100/10', "It's a horror game.\nnot for you but for your enemies", "Playing it delivers the same cathartic craze the original Doom and Doom II did in the early '90s: overwhelmed by the horrors around every turn, but empowered with an impressive collection of weapons at the ready.\n\nBut the new Doom is louder and faster than the old model. Its battles ask more of you, and its heavy-metal soundtrack causes your body to quiver from turbulent surges of adrenaline. From the outset two things are made immediately clear: you were born to kill demons, and you'll do anything it takes."], 'id': '7c936b55-bffe-4db3-aa3a-197d913cb90f', '_version_': 1718941055984861184}

	if target is None:
		return "The game with id " + id + "wasn't one of the search results"


	return render_template("game.html",target=target)

@app.route("/results", methods=["GET"])
def results():
	text = request.args["text"]
	field = int(request.args["field"])
	
	hideNsfw = False if request.args.get("nsfw") == None else True

	translator = Translator(service_urls=['translate.googleapis.com'])
	result = translator.translate(text, dest='en')
	
	text = result.text

	maxprice = request.args.get("maxprice")
	minprice = request.args.get("minprice")

	tags = request.args.get("tags")
	developer = request.args.get("developer")
	publisher = request.args.get("publisher")
	languages = request.args.get("languages")

	sortby = request.args.get("pricesort")
	if sortby == "None": sortby=None
	
	print(solrFunctions.buildString(field, text,tags,minprice, maxprice,languages, publisher, developer, sortby, hideNsfw))
	query = solrFunctions.buildString(field, text,tags,minprice, maxprice,languages, publisher, developer, sortby, hideNsfw)
	games = request_api.solr.search(query[0], **query[1])

	#query solr and pass the results to the results page with text and field retrieved from search page
	#put the results in games variable, should be a list of games
	# games = [
	# 	{'url': ['https://store.steampowered.com/app/379720/DOOM/'], 'name': ['DOOM'], 'desc_snippet': 'Now includes all three premium DLC packs (Unto the Evil, Hell Followed, and Bloodfall), maps, modes, and weapons, as well as all feature updates including Arcade Mode, Photo Mode, and the latest Update 6.66, which brings further multiplayer improvements as well as revamps multiplayer progression.', 'recent_reviews': [89], 'all_reviews': [92], 'release_date': ['2016-05-12T00:00:00Z'], 'developer': ['id Software'], 'publisher': ['Bethesda Softworks'], 'popular_tags': ['FPS', 'Gore', 'Action', 'Demons', 'Shooter', 'First-Person', 'Great Soundtrack', 'Multiplayer', 'Singleplayer', 'Fast-Paced', 'Sci-fi', 'Horror', 'Classic', 'Atmospheric', 'Difficult', 'Blood', 'Remake', 'Zombies', 'Co-op', 'Memes'], 'game_details': ['Single-player', 'Multi-player', 'Co-op', 'Steam Achievements', 'Steam Trading Cards', 'Partial Controller Support', 'Steam Cloud'], 'languages': ['English', 'French', 'Italian', 'German', 'Spanish - Spain', 'Japanese', 'Polish', 'Portuguese - Brazil', 'Russian', 'Traditional Chinese'], 'achievements': [54.0], 'genre': ['Action'], 'game_description': ' About This Game Developed by id software, the studio that pioneered the first-person shooter genre and created multiplayer Deathmatch, DOOM returns as a brutally fun and challenging modern-day shooter experience. Relentless demons, impossibly destructive guns, and fast, fluid movement provide the foundation for intense, first-person combat – whether you’re obliterating demon hordes through the depths of Hell in the single-player campaign, or competing against your friends in numerous multiplayer modes. Expand your gameplay experience using DOOM SnapMap game editor to easily create, play, and share your content with the world. STORY: You’ve come here for a reason. The Union Aerospace Corporation’s massive research facility on Mars is overwhelmed by fierce and powerful demons, and only one person stands between their world and ours.  As the lone DOOM Marine, you’ve been activated to do one thing – kill them all. KEY FEATURES: A Relentless Campaign There is no taking cover or stopping to regenerate health as you beat back Hell’s raging demon hordes.  Combine your arsenal of futuristic and iconic guns, upgrades, movement and an advanced melee system to knock-down, slash, stomp, crush, and blow apart demons in creative and violent ways. Return of id Multiplayer Dominate your opponents in DOOM’s signature, fast-paced arena-style combat. In both classic and all-new game modes, annihilate your enemies utilizing your personal blend of skill, powerful weapons, vertical movement, and unique power-ups that allow you to play as a demon. Endless Possibilities DOOM SnapMap – a powerful, but easy-to-use game and level editor – allows for limitless gameplay experiences on every platform.  Without any previous experience or special expertise, any player can quickly and easily snap together and visually customize maps, add pre-defined or completely custom gameplay, and even edit game logic to create new modes.  Instantly play your creation, share it with a friend, or make it available to players around the world – all in-game with the push of a button. ', 'minimum_requirements': ['Minimum:,OS:,Windows 7/8.1/10 (64-bit versions),Processor:,Intel Core i5-2400/AMD FX-8320 or better,Memory:,8 GB RAM,Graphics:,NVIDIA GTX 670 2GB/AMD Radeon HD 7870 2GB or better,Storage:,55 GB available space,Additional Notes:,Requires Steam activation and broadband internet connection for Multiplayer and SnapMap'], 'recommended_requirements': ['Recommended:,OS:,Windows 7/8.1/10 (64-bit versions),Processor:,Intel Core i7-3770/AMD FX-8350 or better,Memory:,8 GB RAM,Graphics:,NVIDIA GTX 970 4GB/AMD Radeon R9 290 4GB or better,Storage:,55 GB available space,Additional Notes:,Requires Steam activation and broadband internet connection for Multiplayer and SnapMap'], 'original_price': [19.99], 'app_id': [379720], 'reviews': ["Dark Souls: you're stuck in a room with demons\n\nDoom: Demons are stuck in a room with you", "As a psychological consultant, here's my professional opinion:\n\nYou angry? Play DOOM to let it all out.\nYou depressed? Play DOOM to feel satisfaction.\nYou shy? Play DOOM to gain confidence.\nYou fine? Play DOOM to feel [b]even better[/b].\n\nGames don't cause violence. Go squash in some heads. Go blow off some steam. Have fun.", 'Are you angry? - Play DOOM.\nAre you in a bad mood? - Play DOOM.\nAre you in a good mood? - Play DOOM.\nDid you have a bad day at work? - Play DOOM.\nIs your boss a jerk? - Play DOOM.\nYour girlfriend dumped you? - Play DOOM.\nDo you feel lonely? - Play DOOM.\nPlay DOOM? - Play DOOM.\n', "Dark Souls: you're stuck in a room with demons\n\nDoom: Demons are stuck in a room with you\n", 'Other games: 20 min. intro and tutorial.\n\nDoom: Here is a gun. Shoot everything.', "Yep, It's a survival horror game. You play as the horror, and the demons are trying to survive.", '1. Do you like FPS games?\n2. Do you like violence?\n3. Do you like gory violence?\n4. Do you like gory, violent FPS games?\n5. Do you like gory, violent FPS games with a great sense of humour?\n6. Do you like metal?\n\nIf you answered yes to any of those questions, this is the game for you.\n\nBrutal.', 'Its a survival horror game. But for your enemies.\n100/10', "It's a horror game.\nnot for you but for your enemies", "Playing it delivers the same cathartic craze the original Doom and Doom II did in the early '90s: overwhelmed by the horrors around every turn, but empowered with an impressive collection of weapons at the ready.\n\nBut the new Doom is louder and faster than the old model. Its battles ask more of you, and its heavy-metal soundtrack causes your body to quiver from turbulent surges of adrenaline. From the outset two things are made immediately clear: you were born to kill demons, and you'll do anything it takes."], 'id': '7c936b55-bffe-4db3-aa3a-197d913cb90f', '_version_': 1718941055984861184},
	# 	{'url': ['https://store.steampowered.com/app/2280/Ultimate_Doom/'], 'name': ['Ultimate Doom'], 'desc_snippet': 'The complete megahit game that set the world afire. Plus All-New Episode IV: Thy Flesh Consumed. The demons came and the marines died. Except one. You are the last defense against these hell-spawned hordes. Prepare for the most intense mutant-laden, blood-splattered action ever!', 'recent_reviews': [92], 'all_reviews': [93], 'release_date': ['1995-04-30T00:00:00Z'], 'developer': ['id Software'], 'publisher': ['id Software'], 'popular_tags': ['Classic', 'FPS', 'Action', "1990's", 'Great Soundtrack', 'Demons', 'Moddable', 'Masterpiece', 'Retro', 'Singleplayer', 'Shooter', 'Gore', 'Sci-fi', 'First-Person', 'Old School', 'Fast-Paced', 'Violent', 'Multiplayer', '2.5D', 'Difficult'], 'game_details': ['Single-player', 'Steam Cloud'], 'languages': ['English'], 'genre': ['Action'], 'game_description': " About This Game The complete megahit game that set the world afire. Plus All-New Episode IV: Thy Flesh Consumed. The demons came and the marines died. Except one. You are the last defense against these hell-spawned hordes. Prepare for the most intense mutant-laden, blood-splattered action ever! The texture-mapped virtual world is so real, you don't just play DOOM - you live it. The Ultimate DOOM takes you beyond anything you've ever experienced. First, you get all three original episodes - that's 27 levels of awesome, explosive excitement. Then it really blows you away with an all-new episode: Thy Flesh Consumed. Now you're dead meat. Just when you think you're getting pretty good at DOOM, you get hit with Perfect Hatred, Sever the Wicked and seven other expert levels never seen before! They're so incredibly tough, the first 27 levels will seem like a walk in the park!", 'original_price': [14.99], 'app_id': [2280], 'reviews': ['EDIT: Doom & Doom 2 were updated and were given the same treatment that the modern console ports got. If, by chance, you don\'t like playing the new versions of Doom & Doom 2, or if you want to play more fan-made Doom add-ons, consider reading this guide I made a while ago. It\'s mandatory to read if you plan to buy Heretic or Hexen, though.\n\n\nNew to Doom? Follow this little guide:\n\nStep 1: Buy the game. Simple as that.\nStep 2: Don\'t actually play it via Steam. Instead, go to the folder where Steam installs it.\nStep 3: You\'ll find a file called "DOOM.WAD". Leave the window open for now.\nStep 4: Download GZDoom. It\'s safe, free, and up to date even to this day. Installation isn\'t even required.\nStep 5: Unzip the folder, and enter it.\nStep 6: Copy/Paste the DOOM.WAD file into the GZDoom folder.\nStep 7: Launch GZDoom.exe.\nBonus Step: Start back at step 1 if you plan on buying Doom 2, Final Doom, Master Levels for Doom 2, Heretic, or Hexen.\n\nCongratulations! Now you can play Doom to its full extent!', 'doom', 'its doom', 'DOOM', 'I made them pay for what they did to Daisy', 'Cant run doom eternal', "Best anger management therapy.\nJust run and gun, it's lots of fun.", "to negatively review a classic doom it's like saying league of legends is a decent game", 'I sold cs:go skins to buy this for a dollar. Best investment ever.', 'doom'], 'id': '11817f83-5b68-47b2-83d1-1bac5d97fd0c', '_version_': 1718941056076087296},
	# 	{'url': ['https://store.steampowered.com/app/782330/DOOM_Eternal/'], 'name': ['DOOM Eternal'], 'desc_snippet': 'As the DOOM Slayer, you return to find Earth has suffered a demonic invasion. Raze Hell and discover the Slayer’s origins and his enduring mission to rip and tear…until it is done.', 'recent_reviews': [-1], 'all_reviews': [-1], 'release_date': ['2019-11-22T00:00:00Z'], 'developer': ['id Software'], 'publisher': ['Bethesda Softworks'], 'popular_tags': ['Gore', 'Violent', 'Action', 'FPS', 'Great Soundtrack', 'Demons', 'Singleplayer', 'First-Person', 'Fast-Paced', 'Multiplayer', 'Shooter', 'Sci-fi', 'Masterpiece', 'Atmospheric', 'Story Rich', 'Post-apocalyptic', 'Horror', 'Adventure', 'Blood', 'Mature'], 'game_details': ['Single-player', 'Multi-player', 'Online Multi-Player', 'Partial Controller Support'], 'languages': ['English', 'French', 'Italian', 'German', 'Spanish - Spain', 'Japanese', 'Korean', 'Portuguese - Brazil', 'Simplified Chinese', 'Spanish - Latin America', 'Traditional Chinese', 'Polish', 'Russian'], 'genre': ['Action'], 'game_description': " About This Game As the DOOM Slayer, you return to find Earth has suffered a demonic invasion. Raze Hell and discover the Slayer’s origins and his enduring mission to rip and tear…until it is done. Experience the ultimate combination of speed and power as you battle your way across dimensions with the next leap in push-forward, first-person combat. Slayer Threat Level at Maximum Armed with a shoulder-mounted flamethrower, retractable wrist-mounted blade, upgraded guns and mods, and abilities like the Double Dash, you're faster, stronger, and more versatile than ever. Unholy Trinity Take what you need from your enemies: Glory kill for extra health, incinerate for armor, and chainsaw demons to stock up on ammo to become the ultimate demon-slayer. BATTLEMODE A new 2 versus 1 multiplayer experience built from the ground up at id Software. A fully-armed DOOM Slayer faces off against two player-controlled demons, duking it out over three rounds of intense first-person combat.", 'mature_content': ' Mature Content Description  The developers describe the content like this:  Similar to DOOM from 2016, DOOM Eternal will contain Blood and Gore, Intense Violence and Strong Language  ', 'minimum_requirements': ['Minimum:,Requires a 64-bit processor and operating system'], 'recommended_requirements': ['Recommended:,Requires a 64-bit processor and operating system'], 'original_price': [59.99], 'app_id': [782330], 'reviews': ['Okay, as a 50+ year old gamer who\'s been playing since the 1970\'s I know my limits and I tend to stay away from "twitch" games where reaction times have to be razor sharp. With that in mind I avoided this game for a while, in spite of having enjoyed and finished every previous DOOM iteration from the beginning. When it went on a great sale I figured "what the heck" and decided to give it a try, thinking it might be a short-lived experiment. \n\nBoy was I wrong. The controls are intuitive and easy to master. The encounters are a blast and even failing is pretty fun as you figure out where you went wrong. I\'m playing on the second level of difficulty and finding it challenging but just challenging enough to make it a lot more fun. The music and graphics are also excellent and add to the excitement.\n\nI do find that the best technique for surviving a difficult battle is to to just pace myself, taking bites out of the boss and avoiding going toe-to-toe with them as I run and jump around. I keep flaming and death punching the baddies to keep my armor and health up and I choose a weak one every now and then to chainsaw and get the ammo up. \n\nI can\'t really recommend this game enough. It\'s well balanced and exciting but not too overwhelming and it really rewards the creative use of weapons and using actual strategies. If you\'re old like me, don\'t be afraid and give it a go. You\'ll be glad you did.', 'Steam Sale is temporary.\nDOOM is Eternal.', 'A Christian game with Christian values. GOTY', "couldn't afford therapy", 'Are you angry? - Play DOOM Eternal.\nAre you in a restaurant? - Play DOOM Eternal.\nAre you in a bad mood? - Play DOOM Eternal.\nAre you in a good mood? - Play DOOM Eternal.\nDid you have a bad day at work? - Play DOOM Eternal.\nIs your boss a jerk? - Play DOOM Eternal.\nYour girlfriend dumped you? - Play DOOM Eternal.\nDo you feel lonely? - Play DOOM Eternal.\nDo you want to eat? - Play DOOM Eternal.\nDid you fail the exam? - Play DOOM Eternal.\nPlay DOOM Eternal? - Play DOOM Eternal.', 'Good game with Good Christian Values', 'This new Mick Gordon album has an excellent demon slaying game attached to it\n\n11/10 Would rip and tear', 'Be sure to play the tutorial, DOOM (2016).', '[h1] Violence is never the answer. Violence is the question. And the answer is, yes. [/h1]\n\nDoom Eternal is a masterpiece of gore and violence, a pure art form of killing demons in almost any way imaginable, it took what the first game had and cranked it all to the maximum.\n\nThe combat is faster, and even more brutal, with absolutely stunning glory kill animations that never get old. It makes you use every single gun and master them, the Arenas are made to test every ounce of your mastery, they are fun/beautifully designed, yet exceedingly challenging, every single game mechanic WILL by the end of the game be mastered (that\'s what it took me to beat nightmare difficulty).\n\n[h1] Mick Gordon, the only thing i fear is you  [/h1]\n\nGordon has single-handedly carried both Doom 2k16 and Doom Eternal, this man\'s soundtracks make the combat and gore achieve ungodly amounts of insanity and adrenaline, some of these tracks are my favorite\'s and i listen too them everyday, but i think he did a better job in 2k16, it had much more "unique" tracks compared to Eternal.\n\n[h1] Doom Eternal and the Quest for Ammo  [/h1]\n\nThis game has insanely low amounts of ammo compared too 2k16. You will have to chainsaw a lot while playing to get the ammo back, this was enough for the game to be refunded by a good amount of people.\n\nI can understand, and i agree, there have been many times that i had to run across the arena to chainsaw kill a guy for ammo, i personally don\'t mind this at all, and i love the glory kill animations, but this could prove to be a big problem for some people.\n\n[h1] Buying Doom Eternal isn\'t a question, it\'s the answer  [/h1]\n\nWhile it has ammo problems, the rest of the game shines brilliantly, a polished masterpiece of demon killing and violence, i believe if you can give this game a fair try, you won\'t be able to go back too Doom 2k16, atleast i can\'t.', 'Everybody gansta until you met Marauder.\n\nPd: Turn off Steam Overlay, you can get more FPS.'], 'id': '32da355f-125f-425f-bca5-5dcb023f241b', '_version_': 1718941056356057088}
	# ]

	return render_template("results.html", games=games, length=len(games), querytext=text, queryfield=field)
	
if __name__ == "__main__":
    app.run(debug=True)